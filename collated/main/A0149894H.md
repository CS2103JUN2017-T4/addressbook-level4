# A0149894H
###### /java/seedu/whatsnext/logic/commands/ChangePathCommand.java
``` java
public class ChangePathCommand extends Command {
    public static final String COMMAND_WORD = "changepath";
    public static final String MESSAGE_USAGE = COMMAND_WORD
            + ": Changes where task manager is stored. Takes in new file location";
    public static final String MESSAGE_CREATED_NEW_CONFIG_FILE = "TEST";
    public static final String MESSAGE_REPEAT_TASK_MANAGER_FILE_PATH = "This file is already saved at this location";
    public static final String MESSAGE_SUCCESS = "Save location changed to: %1$s";

    private static final Logger logger = LogsCenter.getLogger(ChangePathCommand.class);



    private static File toSave;




    public ChangePathCommand(File filePath) {
        toSave = filePath;
    }

    @Override
    public CommandResult execute() throws CommandException {
        try {
            //delete
            deleteOldFile();

            //overwrite filepath
            String stringLocation = overwriteFilePath();

            //set new file path in config
            Config config = new Config();
            config.setTaskManagerFilePath(stringLocation);
            ConfigUtil.saveConfig(config, Config.DEFAULT_CONFIG_FILE);


            XmlTaskManagerStorage.changeTaskManagerFilePath(stringLocation);
            model.saveTaskManager();

            return new CommandResult(String.format(MESSAGE_SUCCESS, toSave));
        } catch (Config.RepeatTaskManagerFilePathException dtmfpe) {
            throw new CommandException(MESSAGE_REPEAT_TASK_MANAGER_FILE_PATH);
        } catch (IOException ioe) {
            logger.warning("Failed to save config file : " + StringUtil.getDetails(ioe));
            throw new CommandException(MESSAGE_CREATED_NEW_CONFIG_FILE);
        }

    }

    private String overwriteFilePath() throws IOException {
        File myFoo = new File("filepath");
        FileWriter fooWriter = new FileWriter(myFoo, false);

        String stringLocation = toSave.toString();
        fooWriter.write(stringLocation);
        fooWriter.close();
        return stringLocation;
    }

    private void deleteOldFile() {
        File f = new File("test.txt");
        String string = f.getAbsolutePath();
        int texttxtSize = 8;
        int size = string.length() - texttxtSize;
        string = string.substring(0, size);
        String deleteLocation = String.format(string).concat(Config.getTaskManagerFilePath());
        deleteLocation = deleteLocation.replace("\\", "/");
        File toDeleteFilePath = new File(deleteLocation);
        toDeleteFilePath.delete();
    }


}
```
###### /java/seedu/whatsnext/logic/commands/FilePathCommand.java
``` java
public class FilePathCommand extends Command {
    public static final String COMMAND_WORD = "filepath";
    public static final String MESSAGE_SUCCESS = "File Path located at:";
    public static final String MESSAGE_USAGE = COMMAND_WORD + ": Locates the path where the storage xml file exists.";

    public FilePathCommand() {
    }

    @Override
    public CommandResult execute() throws CommandException {
        //requireNonNull(model);
        return new CommandResult(String.format(MESSAGE_SUCCESS, Config.getTaskManagerFilePath()));

    }

}

```
###### /java/seedu/whatsnext/logic/parser/ChangePathCommandParser.java
``` java
public class ChangePathCommandParser {

    public Command parse(String args) {

        String stringSaveLocation = args.trim();
        File targetLocation = new File(args.trim());
        String emptyString = "";

        if (emptyString.equals(args)) {
            return new WrongCommand(String.format(MESSAGE_INVALID_COMMAND_FORMAT, ChangePathCommand.MESSAGE_USAGE));
        }
        if (!targetLocation.exists()) {
            targetLocation.mkdir();
        }
        if (!(stringSaveLocation.substring(stringSaveLocation.length() - 1).equals("/"))) {
            stringSaveLocation += "/";
        }

        stringSaveLocation += "whatsnext.xml";

        File newLocation = new File(stringSaveLocation.trim());

        return new ChangePathCommand(newLocation);
    }
}
```
###### /java/seedu/whatsnext/logic/parser/Parser.java
``` java
        case ChangePathCommand.COMMAND_WORD:
            return new ChangePathCommandParser().parse(arguments);

```
###### /java/seedu/whatsnext/logic/parser/Parser.java
``` java
        case FilePathCommand.COMMAND_WORD:
            return new FilePathCommand();

```
###### /java/seedu/whatsnext/MainApp.java
``` java
    @Override
    public void init() throws Exception {
        logger.info("=============================[ Initializing WhatsNext ]===========================");
        super.init();

        config = initConfig(getApplicationParameter("config"));


        setUpFilePath();

        initFilePath(path);


        UserPrefsStorage userPrefsStorage = new JsonUserPrefsStorage(config.getUserPrefsFilePath());
        userPrefs = initPrefs(userPrefsStorage);
        TaskManagerStorage taskManagerStorage = new XmlTaskManagerStorage(config.getTaskManagerFilePath());
        storage = new StorageManager(taskManagerStorage, userPrefsStorage);

        initLogging(config);

        model = initModelManager(storage, userPrefs);

        logic = new LogicManager(model);

        ui = new UiManager(logic, config, userPrefs);

        initEventsCenter();
    }

```
###### /java/seedu/whatsnext/MainApp.java
``` java
    private void setUpFilePath() {
        File f = new File("test.txt");
        path = f.getAbsolutePath();
        int texttxtSize = 8;
        int size = path.length() - texttxtSize;
        path = path.substring(0, size);
        path = path.replace("\\", "/");
        path = String.format(path).concat("filepath");
    }
```
###### /java/seedu/whatsnext/MainApp.java
``` java
    public void initFilePath(String path) throws IOException {
        FileReader fr = new FileReader(path);
        BufferedReader textReader = new BufferedReader(fr);
        String filepath = textReader.readLine();
        try {
            config.setTaskManagerFilePath(filepath);
        } catch (RepeatTaskManagerFilePathException e) {
            e.printStackTrace();
        }
        textReader.close();
    }

    private String getApplicationParameter(String parameterName) {
        Map<String, String> applicationParameters = getParameters().getNamed();
        return applicationParameters.get(parameterName);
    }

    private Model initModelManager(Storage storage, UserPrefs userPrefs) {
        Optional<ReadOnlyTaskManager> taskManagerOptional;
        ReadOnlyTaskManager initialData;
        try {
            taskManagerOptional = storage.readTaskManager();
            if (!taskManagerOptional.isPresent()) {
                logger.info("Data file not found. Will be starting with a sample TaskManager");
            }
            initialData = taskManagerOptional.orElseGet(SampleDataUtil::getSampleTaskManager);
        } catch (DataConversionException e) {
            logger.warning("Data file not in the correct format. Will be starting with an empty TaskManager");
            initialData = new TaskManager();
        } catch (IOException e) {
            logger.warning("Problem while reading from the file. Will be starting with an empty TaskManager");
            initialData = new TaskManager();
        }

        return new ModelManager(initialData, userPrefs);
    }

    private void initLogging(Config config) {
        LogsCenter.init(config);
    }

    protected Config initConfig(String configFilePath) {
        Config initializedConfig;
        String configFilePathUsed;

        configFilePathUsed = Config.DEFAULT_CONFIG_FILE;

        if (configFilePath != null) {
            logger.info("Custom Config file specified " + configFilePath);
            configFilePathUsed = configFilePath;
        }

        logger.info("Using config file : " + configFilePathUsed);

        try {
            Optional<Config> configOptional = ConfigUtil.readConfig(configFilePathUsed);
            initializedConfig = configOptional.orElse(new Config());
        } catch (DataConversionException e) {
            logger.warning("Config file at " + configFilePathUsed + " is not in the correct format. "
                    + "Using default config properties");
            initializedConfig = new Config();
        }

        //Update config file in case it was missing to begin with or there are new/unused fields
        try {
            ConfigUtil.saveConfig(initializedConfig, configFilePathUsed);
        } catch (IOException e) {
            logger.warning("Failed to save config file : " + StringUtil.getDetails(e));
        }
        return initializedConfig;
    }

    protected UserPrefs initPrefs(UserPrefsStorage storage) {
        String prefsFilePath = storage.getUserPrefsFilePath();
        logger.info("Using prefs file : " + prefsFilePath);

        UserPrefs initializedPrefs;
        try {
            Optional<UserPrefs> prefsOptional = storage.readUserPrefs();
            initializedPrefs = prefsOptional.orElse(new UserPrefs());
        } catch (DataConversionException e) {
            logger.warning("UserPrefs file at " + prefsFilePath + " is not in the correct format. "
                    + "Using default user prefs");
            initializedPrefs = new UserPrefs();
        } catch (IOException e) {
            logger.warning("Problem while reading from the file. Will be starting with an empty TaskManager");
            initializedPrefs = new UserPrefs();
        }

        //Update prefs file in case it was missing to begin with or there are new/unused fields
        try {
            storage.saveUserPrefs(initializedPrefs);
        } catch (IOException e) {
            logger.warning("Failed to save config file : " + StringUtil.getDetails(e));
        }

        return initializedPrefs;
    }

    private void initEventsCenter() {
        EventsCenter.getInstance().registerHandler(this);
    }

    @Override
    public void start(Stage primaryStage) {
        logger.info("Starting TaskManager " + MainApp.VERSION);
        ui.start(primaryStage);
    }

    @Override
    public void stop() {
        logger.info("============================ [ Stopping WhatsNext ] =============================");
        ui.stop();
        try {
            storage.saveUserPrefs(userPrefs);
        } catch (IOException e) {
            logger.severe("Failed to save preferences " + StringUtil.getDetails(e));
        }
        Platform.exit();
        System.exit(0);
    }

    @Subscribe
    public void handleExitAppRequestEvent(ExitAppRequestEvent event) {
        logger.info(LogsCenter.getEventHandlingLogMessage(event));
        this.stop();
    }

    public static void main(String[] args) {
        launch(args);
    }
}
```
